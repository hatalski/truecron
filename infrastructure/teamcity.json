{"Outputs":{"AWSEBLoadBalancerURL":{"Value":{"Fn::Join":["",["http:\/\/",{"Fn::GetAtt":["AWSEBLoadBalancer","DNSName"]}]]},"Description":"The ElasticBeanstalk ELB URL of the website"}},"Parameters":{"LogPublicationControl":{"Default":"false","NoEcho":"true","Description":"If true customer service logs will be published to S3.","AllowedValues":["true","false"],"Type":"String","ConstraintDescription":"must be Boolean."},"NodeEnableGzip":{"Default":"false","NoEcho":"true","AllowedValues":["true","false"],"Description":"Specifies if gzip compression is enabled.","Type":"String"},"NodeVersion":{"Default":"0.10.26","NoEcho":"true","AllowedValues":["0.8.6","0.8.7","0.8.8","0.8.9","0.8.10","0.8.11","0.8.12","0.8.13","0.8.14","0.8.15","0.8.16","0.8.17","0.8.18","0.8.19","0.8.20","0.8.21","0.8.24","0.8.26","0.10.10","0.10.21","0.10.26"],"Description":"Version of Node.js.","Type":"String"},"AWSEBReferrerId":{"Default":"","NoEcho":"true","Type":"String"},"NodeStaticFiles":{"Default":"","NoEcho":"true","Description":"The directory to serve as static content.","Type":"CommaDelimitedList"},"NodeCommand":{"Default":"","NoEcho":"true","Description":"Command to start the Node.js application. If an empty string is specified, app.js is used, then server.js, then \"npm start\" in that order.","Type":"String"},"InstancePort":{"Default":"80","NoEcho":"true","Description":"Listen Port","Type":"String"},"AWSEBEnvironmentId":{"NoEcho":"true","Type":"String"},"AWSEBAgentId":{"Default":"","NoEcho":"true","Type":"String"},"ServerPort":{"Default":"8080","NoEcho":"true","Description":"Server Port","Type":"String"},"AWSEBEnvironmentName":{"NoEcho":"true","Type":"String"},"AWSEBEnvironmentBucket":{"NoEcho":"true","Type":"String"},"AppSource":{"Default":"http:\/\/s3.amazonaws.com\/elasticbeanstalk-samples-us-east-1\/nodejs-sample.zip","NoEcho":"true","Description":"Application Source","Type":"String"},"ProxyServer":{"Default":"nginx","NoEcho":"true","AllowedValues":["apache","nginx","none"],"Description":"Specifies which proxy server to be used for client connections. Static file mappings and gzip compression will not take effect if the proxy server is set to \"none\".","Type":"String"},"EnvironmentVariables":{"Default":"AWS_ACCESS_KEY_ID=,AWS_SECRET_KEY=,PARAM1=,PARAM2=,PARAM3=,PARAM4=,PARAM5=","NoEcho":"true","Description":"Program environment variables.","Type":"CommaDelimitedList"},"InstanceType":{"Default":"t1.micro","NoEcho":"true","Description":"WebServer EC2 instance type","AllowedValues":["t1.micro","m1.small","m1.medium","m1.large","m1.xlarge","c1.medium","c1.xlarge","m2.xlarge","m2.2xlarge","m2.4xlarge","m3.medium","m3.large","m3.xlarge","m3.2xlarge","c3.large","c3.xlarge","c3.2xlarge","c3.4xlarge","c3.8xlarge","cc1.4xlarge","cc2.8xlarge","cg1.4xlarge","hi1.4xlarge","hs1.8xlarge","cr1.8xlarge","g2.2xlarge","i2.xlarge","i2.2xlarge","i2.4xlarge","i2.8xlarge","r3.large","r3.xlarge","r3.2xlarge","r3.4xlarge","r3.8xlarge"],"Type":"String","ConstraintDescription":"must be a valid EC2 instance type."}},"Description":"AWS Elastic Beanstalk environment (Name: 'dev-cloudcron'  Id: 'e-x4bpqueg2m')","Mappings":{"EnvironmentInfoTasks":{"systemtail":{"AutoClean":"true","CommandName":"CMD-SystemTailLogs","LocationPrefix":"resources\/environments\/logs\/systemtail\/"},"bundle":{"CommandName":"CMD-BundleLogs","LocationPrefix":"resources\/environments\/logs\/bundle\/"},"publish":{"LocationPrefix":"resources\/environments\/logs\/publish\/"},"tail":{"AutoClean":"true","CommandName":"CMD-TailLogs","LocationPrefix":"resources\/environments\/logs\/tail\/"}},"AWSEBOptions":{"options":{"FastVersionDeployment":"true","nodeploymentOnStartup":"true","EnvironmentType":"LoadBalanced","ebpatchscripturl":["https:\/\/s3.amazonaws.com\/elasticbeanstalk-env-resources-us-east-1\/eb_patching_resources\/patch_instance.py"],"CloudConfigOptions":"cloud_final_modules:\n - [scripts-user, always]","HaltStartupCommandsOnFailure":"true","ebrpm":"https:\/\/s3.amazonaws.com\/elasticbeanstalk-env-resources-us-east-1\/stalks\/eb_node_js_2.11.1\/lib\/aws-elasticbeanstalk-tools-1.12-1.noarch.rpm","EnvironmentTier":[{"Name":"WebServer","Type":"Standard","Version":"1.0"}],"cfnrpm":"https:\/\/s3.amazonaws.com\/elasticbeanstalk-env-resources-us-east-1\/stalks\/eb_node_js_2.11.1\/lib\/python-certifi-0.0.8-2.3.amzn1.noarch.rpm https:\/\/s3.amazonaws.com\/elasticbeanstalk-env-resources-us-east-1\/stalks\/eb_node_js_2.11.1\/lib\/aws-cfn-bootstrap-1.4-b165.noarch.rpm","DefaultSSHPort":"22","UserDataScript":"https:\/\/s3.amazonaws.com\/elasticbeanstalk-env-resources-us-east-1\/stalks\/eb_node_js_2.11.1\/lib\/UserDataScript.sh","requests":"https:\/\/s3.amazonaws.com\/elasticbeanstalk-env-resources-us-east-1\/stalks\/eb_node_js_2.11.1\/lib\/requests-0.13.5.tar.gz#md5=805fd122b4cfd224e15ff2f5288c5ba0","AutoInstanceTermination":true,"DefaultsScript":"\/opt\/elasticbeanstalk\/containerfiles\/containerdefaults.py","LeaderTestScript":"\/opt\/elasticbeanstalk\/bin\/leader-test.sh","LaunchType":"Migration","downloadSourceBundleScriptLocation":["https:\/\/s3.amazonaws.com\/elasticbeanstalk-env-resources-us-east-1\/eb_patching_resources\/download_source_bundle.py"],"EmbeddedConfigsetsEnabled":"true"}},"AWSEBAWSRegionArch2AMI":{"sa-east-1":{"64hvm":"ami-635dff7e","64":"ami-215dff3c","64graphics":"","64gpu":""},"ap-northeast-1":{"64hvm":"ami-bb562fba","64":"ami-c9562fc8","64graphics":"ami-55c2ba54","64gpu":""},"eu-west-1":{"64hvm":"ami-4b18e33c","64":"ami-2918e35e","64graphics":"ami-2153a956","64gpu":"ami-4518e332"},"us-east-1":{"64hvm":"ami-978d91fe","64":"ami-fb8e9292","64graphics":"ami-ad5f47c4","64gpu":"ami-b98d91d0"},"us-west-1":{"64hvm":"ami-5aba831f","64":"ami-7aba833f","64graphics":"ami-f63800b3","64gpu":""},"us-west-2":{"64hvm":"ami-383a5008","64":"ami-043a5034","64graphics":"ami-1ad3b92a","64gpu":""},"ap-southeast-2":{"64hvm":"ami-cf4ad2f5","64":"ami-3b4bd301","64graphics":"ami-49168e73","64gpu":""},"ap-southeast-1":{"64hvm":"ami-860d5ed4","64":"ami-b40d5ee6","64graphics":"ami-14792a46","64gpu":""}},"AWSEBAWSInstanceType2Arch":{"cg1.4xlarge":{"Arch":"64gpu"},"hs1.8xlarge":{"Arch":"64"},"m1.large":{"Arch":"64"},"i2.4xlarge":{"Arch":"64hvm"},"m1.xlarge":{"Arch":"64"},"c3.4xlarge":{"Arch":"64hvm"},"c3.8xlarge":{"Arch":"64hvm"},"m3.xlarge":{"Arch":"64"},"c3.2xlarge":{"Arch":"64hvm"},"m3.2xlarge":{"Arch":"64"},"m1.small":{"Arch":"64"},"r3.2xlarge":{"Arch":"64hvm"},"r3.8xlarge":{"Arch":"64hvm"},"m2.xlarge":{"Arch":"64"},"m3.large":{"Arch":"64"},"m2.2xlarge":{"Arch":"64"},"r3.large":{"Arch":"64hvm"},"m1.medium":{"Arch":"64"},"r3.4xlarge":{"Arch":"64hvm"},"m3.medium":{"Arch":"64"},"g2.2xlarge":{"Arch":"64graphics"},"cr1.8xlarge":{"Arch":"64hvm"},"c3.xlarge":{"Arch":"64hvm"},"c3.large":{"Arch":"64hvm"},"m2.4xlarge":{"Arch":"64"},"cc2.8xlarge":{"Arch":"64hvm"},"i2.8xlarge":{"Arch":"64hvm"},"t1.micro":{"Arch":"64"},"cc1.4xlarge":{"Arch":"64hvm"},"hi1.4xlarge":{"Arch":"64"},"c1.medium":{"Arch":"64"},"r3.xlarge":{"Arch":"64hvm"},"c1.xlarge":{"Arch":"64"},"i2.2xlarge":{"Arch":"64hvm"},"i2.xlarge":{"Arch":"64hvm"}}},"AWSTemplateFormatVersion":"2010-09-09","Resources":{"AWSEBAutoScalingLaunchConfiguration":{"Type":"AWS::AutoScaling::LaunchConfiguration","Properties":{"IamInstanceProfile":"aws-elasticbeanstalk-ec2-role","ImageId":{"Fn::FindInMap":["AWSEBAWSRegionArch2AMI",{"Ref":"AWS::Region"},{"Fn::FindInMap":["AWSEBAWSInstanceType2Arch",{"Ref":"InstanceType"},"Arch"]}]},"InstanceMonitoring":false,"SecurityGroups":[{"Ref":"AWSEBSecurityGroup"}],"UserData":{"Fn::Base64":{"Fn::Join":["",["Content-Type: multipart\/mixed; boundary=\"===============5189065377222898407==\"","\n","MIME-Version: 1.0","\n","","\n","--===============5189065377222898407==","\n","Content-Type: text\/cloud-config; charset=\"us-ascii\"","\n","MIME-Version: 1.0","\n","Content-Transfer-Encoding: 7bit","\n","Content-Disposition: attachment; filename=\"cloud-config.txt\"","\n","","\n","#cloud-config","\n","repo_upgrade: none","\n","repo_releasever: 2014.03","\n",{"Fn::FindInMap":["AWSEBOptions","options","CloudConfigOptions"]},"\n","","\n","--===============5189065377222898407==","\n","Content-Type: text\/x-shellscript; charset=\"us-ascii\"","\n","MIME-Version: 1.0","\n","Content-Transfer-Encoding: 7bit","\n","Content-Disposition: attachment; filename=\"user-data.txt\"","\n\n","#!\/bin\/bash","\n","exec > >(tee -a \/var\/log\/eb-cfn-init.log|logger -t [eb-cfn-init] -s 2>\/dev\/console) 2>&1","\n","set -x","\n","\n\n","function sleep_delay ","\n","{","\n","  if (( $SLEEP_TIME < $SLEEP_TIME_MAX )); then ","\n","    echo Sleeping $SLEEP_TIME","\n","    sleep $SLEEP_TIME  ","\n","    SLEEP_TIME=$(($SLEEP_TIME * 2)) ","\n","  else ","\n","    echo Sleeping $SLEEP_TIME_MAX  ","\n","    sleep $SLEEP_TIME_MAX  ","\n","  fi","\n","}","\n\n","# Executing bootstrap script","\n","SLEEP_TIME=10","\n","SLEEP_TIME_MAX=3600","\n","while true; do ","\n","  curl ",{"Fn::FindInMap":["AWSEBOptions","options","UserDataScript"]}," > \/tmp\/ebbootstrap.sh ","\n","  RESULT=$?","\n","  if [[ \"$RESULT\" -ne 0 ]]; then ","\n","    sleep_delay ","\n","  else","\n","    \/bin\/bash \/tmp\/ebbootstrap.sh ","    '",{"Fn::FindInMap":["AWSEBOptions","options","requests"]},"'","    '",{"Fn::FindInMap":["AWSEBOptions","options","cfnrpm"]},"'","    '",{"Ref":"AWSEBInstanceLaunchWaitHandle"},"'","    '",{"Ref":"AWS::StackId"},"'","    '",{"Ref":"AWS::Region"},"'","    & ","\n","    exit 0  ","\n","  fi ","\n","done","\n\n","--===============5189065377222898407==-- "]]}},"KeyName":"naviam","InstanceType":{"Ref":"InstanceType"}}},"AWSEBLoadBalancer":{"Type":"AWS::ElasticLoadBalancing::LoadBalancer","Properties":{"AvailabilityZones":["us-east-1c","us-east-1b","us-east-1d"],"Listeners":[{"LoadBalancerPort":"80","InstancePort":{"Ref":"InstancePort"},"Protocol":"HTTP"}],"HealthCheck":{"Timeout":"5","Interval":"30","Target":{"Fn::Join":["",["TCP:",{"Ref":"InstancePort"}]]},"HealthyThreshold":"3","UnhealthyThreshold":"5"}}},"AWSEBInstanceLaunchWaitCondition":{"Type":"AWS::CloudFormation::WaitCondition","DependsOn":"AWSEBAutoScalingGroup","Properties":{"Handle":{"Ref":"AWSEBInstanceLaunchWaitHandle"},"Timeout":"900","Count":"1"}},"AWSEBAutoScalingGroup":{"Type":"AWS::AutoScaling::AutoScalingGroup","Metadata":{"AWS::ElasticBeanstalk::Ext":{"_EnvironmentInfoTaskMapping":"EnvironmentInfoTasks","_TriggersConfig":{"applicationDeploy":{"_Command":"CMD-AppDeploy","_WatchGroups":["_TriggerAppDeployment"]},"configDeploy":{"_Command":"CMD-ConfigDeploy","_WatchGroups":["_TriggerConfigDeployment"]}},"PreferredAvailabilityZones":"","_ParameterTriggers":{"_TriggerAppDeployment":["AppSource"],"_TriggerConfigDeployment":["LogPublicationControl","InstancePort","ServerPort","EnvironmentVariables","NodeVersion","ProxyServer","NodeStaticFiles","NodeCommand"]},"_ContainerConfigFileContent":{"system":{"LogPublicationControl":{"Ref":"LogPublicationControl"},"AWSEBReferrerId":{"Ref":"AWSEBReferrerId"},"ResourcesBase":"https:\/\/s3.amazonaws.com\/elasticbeanstalk-env-resources-us-east-1\/stalks\/eb_node_js_2.11.1\/lib\/","AWSEBAgentId":{"Ref":"AWSEBAgentId"}},"nodejs":{"gzip":{"Ref":"NodeEnableGzip"},"serverport":{"Ref":"ServerPort"},"nodeversion":{"Ref":"NodeVersion"},"staticfiles":{"Ref":"NodeStaticFiles"},"env":["PARAM3=","PARAM4=","PARAM1=","PARAM2=","PARAM5=","AWS_SECRET_KEY=","AWS_ACCESS_KEY_ID="],"proxyserver":{"Ref":"ProxyServer"},"nodecommand":{"Ref":"NodeCommand"},"instanceport":{"Ref":"InstancePort"}}},"_API":{"_Commands":{"CMD-BundleLogs":{"_Stages":{"01_enact":["InfoTask-BundleLogs"]}},"CMD-ConfigDeploy":{"_Stages":{"02_enact":["Hook-EnactConfigDeploy","Hook-PostConfigDeploy"],"01_pre":["Infra-WriteRuntimeConfig","Hook-PreConfigDeploy"]},"_RunStaged":"true"},"CMD-SystemTailLogs":{"_Stages":{"01_enact":["InfoTask-SystemTailLogs"]}},"CMD-PatchInstance":{"_Stages":{"01_enact":["_Infra-PatchInstance"]}},"CMD-TailLogs":{"_Stages":{"01_enact":["InfoTask-TailLogs"]}},"CMD-Startup":{"_Stages":{"02_enact":["Hook-EnactAppDeploy","Hook-PostAppDeploy","Hook-PostInit","Infra-WriteVersionOnStartup"],"01_pre":["Infra-EmbeddedPreBuild","Hook-PreAppDeploy","Infra-EmbeddedPostBuild"]},"_RunStaged":"true"},"CMD-RestartAppServer":{"_Stages":{"02_enact":["Hook-EnactRestartAppServer","Hook-PostRestartAppServer"],"01_enact":["Infra-WriteRuntimeConfig","Hook-PreRestartAppServer"]},"_RunStaged":"false"},"CMD-AppDeploy":{"_Stages":{"02_enact":["Hook-EnactAppDeploy","Hook-PostAppDeploy"],"01_pre":["Infra-WriteRuntimeConfig","Infra-WriteApplication1","Infra-WriteApplication2","Infra-EmbeddedPreBuild","Hook-PreAppDeploy","Infra-EmbeddedPostBuild"]},"_RunStaged":"true"}}},"AvailabilityZoneCount":"Any","_AppSourceUrlFileContent":{"url":{"Ref":"AppSource"}}},"ForcingMetadataUpdate":"Changing something in the metadata will force re-compuation","AWS::CloudFormation::Init":{"Infra-WriteApplication1":{"commands":{"01mkdir":{"command":"rm -rf \/opt\/elasticbeanstalk\/deploy\/appsource\/; mkdir -p \/opt\/elasticbeanstalk\/deploy\/appsource\/"}}},"Infra-WriteBundleLogsConf":{"files":{"\/opt\/elasticbeanstalk\/tasks\/bundlelogs.d\/eb-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/eb-cfn-hup-call*","\/var\/log\/eb-cfn-init-call*","\/var\/log\/eb-cfn-init*","\/var\/log\/eb-tools*","\/var\/log\/eb-publish-logs*","\/var\/log\/directory-hooks-executor*",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/bundlelogs.d\/cfn-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cfn-hup*","\/var\/log\/cfn-init*",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/bundlelogs.d\/eb-version-deployment.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/eb-version-deployment.log",""]]}},"\/opt\/elasticbeanstalk\/tasks\/bundlelogs.d\/cloud-init-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cloud-init*",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/bundlelogs.d\/system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cron","\/var\/log\/messages","\/var\/log\/yum.log",""]]},"mode":"000644"}}},"AWSEBTools":{"packages":{"python":{"requests":"0.13.5","tailer":"https:\/\/s3.amazonaws.com\/elasticbeanstalk-env-resources-us-east-1\/stalks\/eb_node_js_2.11.1\/lib\/tailer-0.3.tar.gz#md5=9d1fc073e48ca682786d50c077e823ce"},"rpm":{"aws-elasticbeanstalk-tools":{"Fn::FindInMap":["AWSEBOptions","options","ebrpm"]}}}},"Hook-PostConfigDeploy":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/configdeploy\/post\/"}}},"Infra-WriteApplication2":{"files":{"\/opt\/elasticbeanstalk\/bin\/download_source_bundle":{"source":{"Fn::Select":[0,{"Fn::FindInMap":["AWSEBOptions","options","downloadSourceBundleScriptLocation"]}]},"owner":"root","group":"root","mode":"000750"}},"commands":{"01downloadVersion":{"command":"\/opt\/elasticbeanstalk\/bin\/download_source_bundle"},"02deleteVersionDownloadScriptFile":{"command":"rm \/opt\/elasticbeanstalk\/bin\/download_source_bundle"}}},"Hook-EnactAppDeploy":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/appdeploy\/enact\/"}}},"NodeContainerInstallHooksPkg":{"sources":{"\/opt\/elasticbeanstalk":"https:\/\/s3.amazonaws.com\/elasticbeanstalk-env-resources-us-east-1\/stalks\/eb_node_js_2.11.1\/lib\/hooks.tar.gz"}},"Infra-WriteVersionOnStartup":{"commands":{"01writeversion":{"command":"getMetadata.py --resource AWSEBBeanstalkMetadata --path AWS::ElasticBeanstalk::Metadata.Version > \/etc\/elasticbeanstalk\/.aws-eb-startup-version"}}},"Hook-PreAppDeploy":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/appdeploy\/pre\/"}}},"configSets":{"Infra-WriteApplication1":["Infra-WriteApplication1"],"_OnInstanceBoot":["NodeContainerInstallHooksPkg","LockRepoToGuid","AWSEBTools","AWSEBBaseConfig","AWSEBCfnHup","Infra-WriteLeaderTestScript","Infra-WriteRuntimeConfig","Infra-WriteApplication1","Infra-WriteApplication2","Infra-WriteTailLogsConf","Infra-WriteSystemTailLogsConf","Infra-WriteBundleLogsConf","Infra-WritePublishLogsConf","Infra-WritePublishLogsCron"],"_Infra-PatchInstance":["Infra-PatchInstance"],"Infra-WriteBundleLogsConf":["Infra-WriteBundleLogsConf"],"Infra-EmbeddedPostBuild":[],"Hook-PostConfigDeploy":["Hook-PostConfigDeploy"],"Infra-WriteApplication2":["Infra-WriteApplication2"],"_AppInstall":["Hook-PreInit","Hook-PreAppDeploy","Hook-EnactAppDeploy","Hook-PostAppDeploy","Hook-PostInit"],"Hook-EnactAppDeploy":["Hook-EnactAppDeploy"],"Infra-EmbeddedPreBuild":[],"Infra-WriteVersionOnStartup":["Infra-WriteVersionOnStartup"],"Hook-PreAppDeploy":["Hook-PreAppDeploy"],"Hook-PreRestartAppServer":["Hook-PreRestartAppServer"],"Hook-EnactRestartAppServer":["Hook-EnactRestartAppServer"],"Infra-WriteSystemTailLogsConf":["Infra-WriteSystemTailLogsConf"],"Infra-WriteRuntimeConfig":["Infra-WriteRuntimeConfig"],"Hook-PostRestartAppServer":["Hook-PostRestartAppServer"],"Hook-PreInit":["Hook-PreInit"],"Infra-WritePublishLogsCron":["Infra-WritePublishLogsCron"],"InfoTask-TailLogs":["InfoTask-TailLogs"],"_OnInstanceReboot":["AWSEBTools","AWSEBBaseConfig","AWSEBCfnHup","Infra-WriteRuntimeConfig","Infra-WriteApplication1","Infra-WriteApplication2"],"Hook-EnactConfigDeploy":["Hook-EnactConfigDeploy"],"Hook-PreConfigDeploy":["Hook-PreConfigDeploy"],"InfoTask-BundleLogs":["InfoTask-BundleLogs"],"Hook-PostInit":["Hook-PostInit"],"Hook-PostAppDeploy":["Hook-PostAppDeploy"],"InfoTask-SystemTailLogs":["InfoTask-SystemTailLogs"],"Infra-WriteTailLogsConf":["Infra-WriteTailLogsConf"],"Infra-WritePublishLogsConf":["Infra-WritePublishLogsConf"],"_AppInstallReboot":["Hook-PreAppDeploy"]},"Infra-WriteLeaderTestScript":{"files":{"\/opt\/elasticbeanstalk\/bin\/leader-test.sh":{"content":{"Fn::Join":["",["#!\/bin\/bash","\n","if [[ \"$EB_IS_COMMAND_LEADER\" == \"true\" ]]; then ","\n","  exit 0 ","\n","else  ","\n","  exit 1 ","\n","fi ","\n"]]},"mode":"000755"}}},"Hook-PreRestartAppServer":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/restartappserver\/pre\/"}}},"Hook-EnactRestartAppServer":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/restartappserver\/enact\/"}}},"Infra-WriteSystemTailLogsConf":{"files":{"\/opt\/elasticbeanstalk\/tasks\/systemtaillogs.d\/eb-version-deployment.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/eb-version-deployment.log",""]]}},"\/opt\/elasticbeanstalk\/tasks\/systemtaillogs.d\/eb-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/eb-cfn-hup-call.log","\/var\/log\/eb-cfn-init-call.log","\/var\/log\/eb-cfn-init.log","\/var\/log\/eb-tools.log","\/var\/log\/eb-publish-logs.log","\/var\/log\/directory-hooks-executor.log",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/systemtaillogs.d\/system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cron","\/var\/log\/messages","\/var\/log\/yum.log",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/systemtaillogs.d\/cloud-init-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cloud-init.log",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/systemtaillogs.d\/cfn-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cfn-hup.log","\/var\/log\/cfn-init.log",""]]},"mode":"000644"}}},"Hook-PostRestartAppServer":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/restartappserver\/post\/"}}},"Infra-WriteRuntimeConfig":{"commands":{"02writeappsource":{"command":{"Fn::Join":["",["getMetadata.py --path AWS::ElasticBeanstalk::Ext._AppSourceUrlFileContent > \/opt\/elasticbeanstalk\/deploy\/configuration\/appsourceurl"]]}},"03writeconfig":{"command":{"Fn::Join":["",["getMetadata.py --path AWS::ElasticBeanstalk::Ext._ContainerConfigFileContent > \/opt\/elasticbeanstalk\/deploy\/configuration\/containerconfiguration"]]}},"01mkdir":{"command":"rm -rf \/opt\/elasticbeanstalk\/deploy\/configuration; mkdir -p \/opt\/elasticbeanstalk\/deploy\/configuration"},"04setperms":{"command":"\/bin\/chmod og-rwx \/opt\/elasticbeanstalk\/deploy\/configuration\/containerconfiguration"}}},"Hook-PreInit":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/preinit\/"}}},"Infra-PatchInstance":{"files":{"\/opt\/elasticbeanstalk\/bin\/patch_instance":{"source":{"Fn::Select":[0,{"Fn::FindInMap":["AWSEBOptions","options","ebpatchscripturl"]}]},"owner":"root","group":"root","mode":"000750"}},"commands":{"01executepatch":{"command":"\/opt\/elasticbeanstalk\/bin\/patch_instance"}}},"Infra-WritePublishLogsCron":{"files":{"\/etc\/cron.d\/publishlogs":{"content":{"Fn::Join":["",["SHELL=\/bin\/bash","\n","PATH=\/sbin:\/bin:\/usr\/sbin:\/usr\/bin","\n","MAILTO=root","\n","HOME=\/","\n","10,30,50 * * * * root ","publishLogs.py --de-dupe --conf-path '\/opt\/elasticbeanstalk\/tasks\/publishlogs.d\/*' --location-prefix ",{"Fn::FindInMap":["EnvironmentInfoTasks","publish","LocationPrefix"]}," --num-concurrent 2","\n","05,25,45 * * * * root ","clearStaleLogPublishingRecords.py","\n"]]},"mode":"000644"}}},"AWSEBBaseConfig":{"files":{"\/etc\/elasticbeanstalk\/.aws-eb-stack.properties":{"content":{"Fn::Join":["",["environment_id=",{"Ref":"AWSEBEnvironmentId"},"\n","environment_bucket=",{"Ref":"AWSEBEnvironmentBucket"},"\n","stack_name=",{"Ref":"AWS::StackId"},"\n","resource=","AWSEBAutoScalingGroup","\n","region=",{"Ref":"AWS::Region"},"\n\n"]]},"owner":"root","group":"root","mode":"000440"},"\/etc\/cfn\/cfn-hup.conf":{"content":{"Fn::Join":["",["[main]","\n","stack=",{"Ref":"AWS::StackId"},"\n","region=",{"Ref":"AWS::Region"},"\n"]]},"owner":"root","group":"root","mode":"000400"},"\/etc\/cfn\/hooks.d\/aws-eb-command-handler.conf":{"content":{"Fn::Join":["",["[aws-eb-command-handler]","\n","triggers=on.command","\n","path=ElasticBeanstalkCommand-","AWSEBAutoScalingGroup","\n","action=commandWrapper.py","\n"]]}}},"commands":{"clearbackupfiles":{"command":"rm -f \/etc\/cfn\/hooks.d\/*.bak"}}},"InfoTask-TailLogs":{"commands":{"taillogs":{"command":{"Fn::Join":["",["tailLogs.py --concatenate --conf-path '\/opt\/elasticbeanstalk\/tasks\/taillogs.d\/*' --location-prefix ",{"Fn::FindInMap":["EnvironmentInfoTasks","tail","LocationPrefix"]}]]}}}},"Hook-EnactConfigDeploy":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/configdeploy\/enact\/"}}},"Hook-PreConfigDeploy":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/configdeploy\/pre\/"}}},"InfoTask-BundleLogs":{"commands":{"bundlelogs":{"command":{"Fn::Join":["",["bundleLogs.py --conf-path '\/opt\/elasticbeanstalk\/tasks\/bundlelogs.d\/*' --location-prefix ",{"Fn::FindInMap":["EnvironmentInfoTasks","bundle","LocationPrefix"]}]]}}}},"Hook-PostInit":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/postinit\/"}}},"LockRepoToGuid":{"files":{"\/etc\/yum\/vars\/guid":{"content":"101d655db21e","mode":"000644"}},"commands":{"03yumRepoMetaClean":{"command":"yum clean all"},"01cloudTemplates":{"command":"sed -i -r 's\/mirror.list$\/mirror.list-\\$guid\/' \/etc\/cloud\/templates\/amzn-updates.repo.tmpl"},"02yumRepos":{"command":"sed -i -r 's\/mirror.list$\/mirror.list-$guid\/' \/etc\/yum.repos.d\/amzn-updates.repo"},"04UpdateOpenssl":{"command":"yum update -y openssl"}}},"Hook-PostAppDeploy":{"commands":{"hooks":{"command":"directoryHooksExecutor.py --path \/opt\/elasticbeanstalk\/hooks\/appdeploy\/post\/"}}},"InfoTask-SystemTailLogs":{"commands":{"systemtaillogs":{"command":{"Fn::Join":["",["tailLogs.py --conf-path '\/opt\/elasticbeanstalk\/tasks\/systemtaillogs.d\/*' --location-prefix ",{"Fn::FindInMap":["EnvironmentInfoTasks","systemtail","LocationPrefix"]}]]}}}},"Infra-WriteTailLogsConf":{"files":{"\/opt\/elasticbeanstalk\/tasks\/taillogs.d\/cfn-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/cfn-hup.log","\/var\/log\/cfn-init.log",""]]},"mode":"000644"},"\/opt\/elasticbeanstalk\/tasks\/taillogs.d\/eb-version-deployment.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/eb-version-deployment.log",""]]}},"\/opt\/elasticbeanstalk\/tasks\/taillogs.d\/eb-system.conf":{"content":{"Fn::Join":["\n",["\/var\/log\/eb-cfn-hup-call.log","\/var\/log\/eb-cfn-init-call.log","\/var\/log\/eb-cfn-init.log","\/var\/log\/eb-tools.log","\/var\/log\/eb-publish-logs.log","\/var\/log\/directory-hooks-executor.log",""]]},"mode":"000644"}}},"Infra-WritePublishLogsConf":{"files":{}},"AWSEBCfnHup":{"services":{"sysvinit":{"cfn-hup":{"ensureRunning":"true"}}}}}},"DependsOn":"AWSEBBeanstalkMetadata","Properties":{"Tags":[{"PropagateAtLaunch":true,"Value":{"Ref":"AWSEBEnvironmentName"},"Key":"elasticbeanstalk:environment-name"},{"PropagateAtLaunch":true,"Value":{"Ref":"AWSEBEnvironmentName"},"Key":"Name"},{"PropagateAtLaunch":true,"Value":{"Ref":"AWSEBEnvironmentId"},"Key":"elasticbeanstalk:environment-id"}],"LoadBalancerNames":[{"Ref":"AWSEBLoadBalancer"}],"AvailabilityZones":["us-east-1c","us-east-1b","us-east-1d"],"MaxSize":"4","Cooldown":"360","LaunchConfigurationName":{"Ref":"AWSEBAutoScalingLaunchConfiguration"},"MinSize":"1"}},"AWSEBSecurityGroup":{"Type":"AWS::EC2::SecurityGroup","Properties":{"GroupDescription":"SecurityGroup for ElasticBeanstalk environment.","SecurityGroupIngress":[{"IpProtocol":"tcp","SourceSecurityGroupName":{"Fn::GetAtt":["AWSEBLoadBalancer","SourceSecurityGroup.GroupName"]},"ToPort":{"Ref":"InstancePort"},"SourceSecurityGroupOwnerId":{"Fn::GetAtt":["AWSEBLoadBalancer","SourceSecurityGroup.OwnerAlias"]},"FromPort":{"Ref":"InstancePort"}}]}},"AWSEBInstanceLaunchWaitHandle":{"Type":"AWS::CloudFormation::WaitConditionHandle"},"AWSEBCloudwatchAlarmLow":{"Type":"AWS::CloudWatch::Alarm","Properties":{"AlarmActions":[{"Ref":"AWSEBAutoScalingScaleDownPolicy"}],"Period":"300","Statistic":"Average","MetricName":"NetworkOut","Threshold":"2000000","EvaluationPeriods":"1","Dimensions":[{"Name":"AutoScalingGroupName","Value":{"Ref":"AWSEBAutoScalingGroup"}}],"AlarmDescription":"ElasticBeanstalk Default Scale Down alarm","Namespace":"AWS\/EC2","ComparisonOperator":"LessThanThreshold"}},"AWSEBCloudwatchAlarmHigh":{"Type":"AWS::CloudWatch::Alarm","Properties":{"AlarmActions":[{"Ref":"AWSEBAutoScalingScaleUpPolicy"}],"Period":"300","Statistic":"Average","MetricName":"NetworkOut","Threshold":"6000000","EvaluationPeriods":"1","Dimensions":[{"Name":"AutoScalingGroupName","Value":{"Ref":"AWSEBAutoScalingGroup"}}],"AlarmDescription":"ElasticBeanstalk Default Scale Up alarm","Namespace":"AWS\/EC2","ComparisonOperator":"GreaterThanThreshold"}},"AWSEBAutoScalingScaleDownPolicy":{"Type":"AWS::AutoScaling::ScalingPolicy","Properties":{"AutoScalingGroupName":{"Ref":"AWSEBAutoScalingGroup"},"ScalingAdjustment":"-1","AdjustmentType":"ChangeInCapacity"}},"AWSEBSecurityGroupSSHIngress":{"Type":"AWS::EC2::SecurityGroupIngress","Properties":{"IpProtocol":"tcp","GroupName":{"Ref":"AWSEBSecurityGroup"},"ToPort":"22","FromPort":"22","CidrIp":"0.0.0.0\/0"}},"AWSEBAutoScalingScaleUpPolicy":{"Type":"AWS::AutoScaling::ScalingPolicy","Properties":{"AutoScalingGroupName":{"Ref":"AWSEBAutoScalingGroup"},"ScalingAdjustment":"1","AdjustmentType":"ChangeInCapacity"}},"AWSEBBeanstalkMetadata":{"Type":"AWS::CloudFormation::WaitConditionHandle","Metadata":{"AWS::ElasticBeanstalk::Ext":{"Parameters":{"NodeVersion":{"Ref":"NodeVersion"},"NodeEnableGzip":{"Ref":"NodeEnableGzip"},"LogPublicationControl":{"Ref":"LogPublicationControl"},"AWSEBReferrerId":{"Ref":"AWSEBReferrerId"},"NodeStaticFiles":{"Ref":"NodeStaticFiles"},"InstancePort":{"Ref":"InstancePort"},"NodeCommand":{"Ref":"NodeCommand"},"AWSEBEnvironmentId":{"Ref":"AWSEBEnvironmentId"},"AWSEBAgentId":{"Ref":"AWSEBAgentId"},"AWSEBEnvironmentName":{"Ref":"AWSEBEnvironmentName"},"ServerPort":{"Ref":"ServerPort"},"AWSEBEnvironmentBucket":{"Ref":"AWSEBEnvironmentBucket"},"AppSource":{"Ref":"AppSource"},"ProxyServer":{"Ref":"ProxyServer"},"EnvironmentVariables":{"Ref":"EnvironmentVariables"},"InstanceType":{"Ref":"InstanceType"}}},"AWS::ElasticBeanstalk::Metadata":{"Name":"e-x4bpqueg2m","EnvironmentName":"dev-cloudcron","Description":"TemplatePack for environment: dev-cloudcron","DateCreated":"2014-06-12T01:33:40","DateUpdated":"2014-06-19T01:56:00","EnvironmentId":"e-x4bpqueg2m","Version":"dc8230be-f754-11e3-ba5b-0fe94aee69b2"}}}}}